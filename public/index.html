<head>
    <script src="linePlot.js"></script>
    <link rel="stylesheet" type="text/css" href="Style.css">
    <title>Monitor Materno Fetal | Cim@lab</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
</head>

<body>
    <!--SIGNAL 1--> 
    <div id="SignalIdentifier">
        <h4 class="deriva">Seleccionar señal | </h4>

        <form id="SignalA" action="demo_form.asp" method="get">
            <input list="momSignal">
            <datalist id="momSignal">
                <option id="formtext" value="Derivación 1"></option>
                <option value="Derivación 2"></option>
                <option value="Derivación 3"></option>
                <option value="Derivación 4"></option>
            </datalist>
        </form>
    </div>

    <canvas id="SignalFirst" width="1200" height="250" style="border:1px solid #000000;">

    </canvas>

    <!-- SIGNAL 2 -->
    <div id="SignalIdentifier">
        <h4 class="deriva">Seleccionar señal | </h4>

        <form id="SignalB" action="demo_form.asp" method="get">
            <input list="momSignal">
            <datalist id="momSignal">
                <option id="formtext" value="Derivación 1"></option>
                <option value="Derivación 2"></option>
                <option value="Derivación 3"></option>
                <option value="Derivación 4"></option>
            </datalist>
        </form>
    </div>

    <canvas id="SignalSecond" width="1200" height="250" style="border:1px solid #000000; margin-top:16;">
    </canvas> 

    <!-- Logos -->
    <div id="something">
        <a href="http://cimlaboratory.com" target="_blank"><img id="logos" src="Assets/cimalabwhite.png"></img></a>
        <a href="http://www.telemedicina.unal.edu.co/" target="_blank"><img id="logos" src="Assets/logo-white.png"></img></a>
    </div>

    <script>
        var countTime = 0;
        var sample = [];
        var NotchMoment =0;
        var NotchVariable=[];
        var NotchVariablePre =[];
        var NotchTimePre =[];
        var Fnotch=[];
        var time =0;
        var NotchTime =[];
            var x=0;
            
        var SigA = new Graph({canvasId: 'SignalFirst', color: '#859F10', thickness: '2', background: 'white', colorRefresh: '#859F10'});
        var SigB = new Graph({canvasId: 'SignalSecond', color: '#1876EF', thickness: '2', background: 'white', colorRefresh: '#1876EF'});
      
        waitToPaint(0);
        function waitToPaint(value)
        {
            value++;

            if (value === 360)
            {
                value = 0;
            }
            setTimeout(function () {
                paintPoint(value);
            }, 10);
        }
        function paintPoint(value)
        {
           SigB.drawNewData(60 + Math.sin(value * (Math.PI / 180)) * 50);
           waitToPaint(value);
       }

       
        var host = window.document.location.host.replace(/:.*/, '');
        var ws = new WebSocket('ws://' + host + ':8081');

        ws.onopen = function (event) {
            var obj = {action: 'register', type: 'viewer'};
            ws.send(JSON.stringify(obj));
        };

        ws.onmessage = function (event) {
            var msg = JSON.parse(event.data);

            if (msg.counter !== undefined){
               // SigB.drawNewData(parseInt(msg.counter));
                
                sample=parseInt(msg.counter);
                countTime = countTime+1;
                time =countTime/2000;
       
                if (countTime<3){  
                    
                  NotchVariable[countTime]=sample;
                  NotchTime[countTime]=time;
                  Fnotch[countTime]=sample;
                  
                }
                 else{
                     
                    NotchVariable[3]=sample;
                    NotchTime[3]=time;
                    Fnotch[countTime]=(0.9968682357708074*NotchVariable[1])+(-1.8537292902972045*NotchVariable[2])+(0.9968682357708074*NotchTime[3])-(-1.8537292902972045*NotchTime[2])-(0.9937364715416148*NotchTime[1]);

                    NotchVariablePre = NotchVariable;
                    NotchVariable = [];
                    NotchVariable[2]=NotchVariablePre[3];
                    NotchVariable[1]=NotchVariablePre[2];
                    
                    NotchTimePre = NotchTime;
                    NotchTime[2]=NotchTimePre[3];
                    NotchTime[1]=NotchTimePre[2];

                 
                function paintPointA(Fnotch,countTime) {
                   x=Math.abs(Fnotch[countTime]);
                   SigA.drawNewData(parseInt(x));
               }
                 paintPointA(Fnotch,countTime);
                }   
               
            }
          
            
        };

    </script>
</body>