<head>
    <script src="linePlot.js"></script>
    <link rel="stylesheet" type="text/css" href="Style.css">
    <title>Monitor Materno Fetal | Cim@lab</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
</head>

<body>
    <!--SIGNAL 1--> 
    <div id="SignalIdentifier">
        <h4 class="deriva">Seleccionar señal | </h4>

        <form id="SignalA" action="demo_form.asp" method="get">
            <input list="momSignal">
            <datalist id="momSignal">
                <option id="formtext" value="Derivación 1"></option>
                <option value="Derivación 2"></option>
                <option value="Derivación 3"></option>
                <option value="Derivación 4"></option>
            </datalist>
        </form>
    </div>

    <canvas id="SignalFirst" width="1200" height="250" style="border:1px solid #000000;">

    </canvas>

    <!-- SIGNAL 2 -->
    <div id="SignalIdentifier">
        <h4 class="deriva">Seleccionar señal | </h4>

        <form id="SignalB" action="demo_form.asp" method="get">
            <input list="momSignal">
            <datalist id="momSignal">
                <option id="formtext" value="Derivación 1"></option>
                <option value="Derivación 2"></option>
                <option value="Derivación 3"></option>
                <option value="Derivación 4"></option>
            </datalist>
        </form>
    </div>

    <canvas id="SignalSecond" width="1200" height="600" style="border:1px solid #000000;"> 
    </canvas> 

    <!-- Logos -->
    <div id="something">
        <a href="http://cimlaboratory.com" target="_blank"><img id="logos" src="Assets/cimalabwhite.png"></img></a>
        <a href="http://www.telemedicina.unal.edu.co/" target="_blank"><img id="logos" src="Assets/logo-white.png"></img></a>
    </div>

    <script>
        var i = 0;
        var sample = [];
        var x = [];
        var x_pre = [];
        var y = [];
        var y_tmp = 0;
        var a = [1, -1.7636, 0.8100];
        var b = [1, -1.8596, 1.000];    
    
        var SigA = new Graph({canvasId: 'SignalFirst', color: '#859F10', thickness: '2', background: 'white', colorRefresh: '#859F10'});
        var SigB = new Graph({canvasId: 'SignalSecond', color: '#1876EF', thickness: '2', background: 'white', colorRefresh: '#1876EF'});
      
        //waitToPaint(0);
        //function waitToPaint(value)
        //{
        //    value++;

        //    if (value === 360)
        //    {
        //        value = 0;
        //   }
        //    setTimeout(function () {
        //        paintPoint(value);
        //    }, 10);
        //}
        //function paintPoint(value)
        //{
          // SigB.drawNewData(60 + Math.sin(value * (Math.PI / 180)) * 50);
          // waitToPaint(value);
       //}

       
        var host = window.document.location.host.replace(/:.*/, '');
        var ws = new WebSocket('ws://' + host + ':8081');

        ws.onopen = function (event) {
            var obj = {action: 'register', type: 'viewer'};
            ws.send(JSON.stringify(obj));
        };

        ws.onmessage = function (event) {
            var msg = JSON.parse(event.data);

            if (msg.counter !== undefined){
               // SigB.drawNewData(parseInt(msg.counter));
                
                sample=parseInt(msg.counter);
                
                function paintPointA(sample) {
                  SigA.drawNewData(parseInt(sample));
                }
                paintPointA(sample);
                
                //console.log("i="+i);
                console.log("sample="+sample);
                if ( i >= 4){
                    x_pre= [];
                    x_pre = x;
                    x = [];
                    x[2]= sample;
                    x[1]= x_pre[2];
                    x[0]= x_pre[1];
                    y[i]=b[0]*x[2]+b[1]*x[1]+b[2]*x[0]-a[1]*y[i-1]-a[2]*y[i-2];
                }
                else if (i===0){
                    y[i]=0;
                }
                else if (i===1){
                    x[0]=sample;
                    y[i]=b[0]*x[0];
                }
                else if (i===2){
                    x[1]=sample;
                    y[i]=b[0]*x[1]+b[1]*x[0]-a[1]*y[i-1];
                }
                else if (i===3){
                    x[2]=sample;
                    y[i]=b[0]*x[2]+b[1]*x[1]+b[2]*x[0]-a[1]*y[i-1]-a[2]*y[i-2];
                }
                
                //console.log("x="+x);
                console.log("y="+y[i]);
                              
                y_tmp=y[i];
                console.log("y_tmp="+y_tmp);//}

                function paintPointB(y_tmp) {
                   SigB.drawNewData(parseInt(y_tmp));
                }
                paintPointB(y_tmp);
                i = i+1;   
               
            }
          
            
        };

    </script>
</body>